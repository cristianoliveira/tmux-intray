#!/usr/bin/env bash
# Main entry point for tmux-intray CLI

set -euo pipefail

VERSION="0.1.0"
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
PROJECT_ROOT="$(dirname "$SCRIPT_DIR")"
COMMANDS_DIR="$PROJECT_ROOT/commands"
LIB_DIR="$PROJECT_ROOT/lib"

# Source core libraries
source "$LIB_DIR/colors.sh"
source "$LIB_DIR/core.sh"

usage() {
    cat << EOF
tmux-intray v${VERSION}

A quiet inbox for things that happen while you're not looking.

USAGE:
    tmux-intray [COMMAND] [OPTIONS]

COMMANDS:
    show            Show all items in the tray (deprecated, use list)
    add <message>   Add a new item to the tray
    list            List notifications with filters and formats
    dismiss <id>    Dismiss a notification
    clear           Clear all items from the tray
    toggle          Toggle the tray visibility
    jump <id>       Jump to the pane of a notification
    status          Show notification status summary
    status-panel    Status bar indicator script (for tmux status-right)
    follow          Monitor notifications in real-time
    help            Show this help message
    version         Show version information

OPTIONS:
    -h, --help      Show help message

EOF
}

main() {
    if [[ $# -eq 0 ]]; then
        usage
        exit 0
    fi

    local command="$1"
    shift || true

    case "$command" in
        show|add|clear|toggle|help|version|list|dismiss|jump|status|follow|status-panel)
            # Load and execute the command
            source "$COMMANDS_DIR/${command}.sh"
            "${command}_command" "$@"
            ;;
        --help|-h)
            usage
            exit 0
            ;;
        *)
            error "Unknown command '$command'"
            echo ""
            usage
            exit 1
            ;;
    esac
}

main "$@"
